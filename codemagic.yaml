workflows:
  unity-build:
    name: Unity Build - IceFishing
    instance_type: mac_mini_m2  
    max_build_duration: 120
    environment:
      unity: 2022.3.62f1 
      vars:
        BUILD_PLATFORM: android
      groups:
        - unity_credentials  
    scripts:

      - name: Build the project
        script: |
          echo "Building Unity project..."
          "$UNITY_HOME/Contents/MacOS/Unity" -batchmode \
            -quit \
            -logFile unity_build.log \
            -projectPath "$CM_PROJECT_DIR/IceFishing" \
            -executeMethod BuildScript.PerformBuild \
            -nographics

    artifacts:
      - build/Android/*.aab
      - unity_build.log  

    publishing:
      scripts:
        - name: Deactivate Unity license
          script: |
            "$UNITY_HOME/Contents/MacOS/Unity" -batchmode \
              -quit \
              -logFile unity_return.log \
              -returnlicense \
              -nographics
