workflows:
  unity-build:
    name: Unity Build - IceFishing
    instance_type: mac_mini_m2
    max_build_duration: 120

    environment:
      unity: 2022.3.62f1
      vars:
        BUILD_PLATFORM: android
      groups:
        - unity_credentials  # UNITY_EMAIL, UNITY_PASSWORD

    scripts:
      - name: Activate Unity Personal license
        script: |
          echo "Activating Unity Personal license..."
          "$UNITY_HOME/Contents/MacOS/Unity" \
            -batchmode \
            -nographics \
            -quit \
            -logFile unity_license.log \
            -username "$UNITY_EMAIL" \
            -password "$UNITY_PASSWORD" \
            -license UnityPersonal

      - name: Build the project
        script: |
          echo "Building Unity project..."
          "$UNITY_HOME/Contents/MacOS/Unity" \
            -batchmode \
            -nographics \
            -quit \
            -logFile unity_build.log \
            -projectPath . \
            -executeMethod BuildScript.PerformBuild

    artifacts:
      - IceFishing.aab
      - IceFishing.apk
      - unity_build.log
      - unity_license.log
